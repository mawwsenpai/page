<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pemberitahuan Penting!</title>
    <link rel="stylesheet" href="css/root.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

    <style>
        body {
            overflow: hidden;
            background-color: var(--bg-primary);
            margin: 0;
            padding: 0;
        }
        .grid-item {
            position: relative;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            filter: grayscale(70%) brightness(50%);
            transition: all 0.3s ease;
            cursor: default;
            margin-bottom: 4px;
        }
        .grid-item.placeholder::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(213, 193, 146, 0.5), transparent);
            transform: translateX(-100%);
            animation: glowLine 5s infinite linear;
            animation-delay: calc(Math.random() * 5s);
        }

        @keyframes glowLine {
            0% { transform: translateX(-150%); }
            100% { transform: translateX(150%); }
        }

        /* Gaya yang sudah ada */
        .mobile-view-container {
            max-width: 450px;
            width: 100%;
            height: 100vh;
            margin: 0 auto;
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        .animated-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-image: url('https://source.unsplash.com/random/1920x1080?abstract,dark,tech');
            background-size: cover;
            background-position: center;
        }
        .image-flow-container {
            display: flex;
            width: fit-content;
            height: 100%;
            animation: slideBackground 150s linear infinite;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .image-flow-container.loaded {
            opacity: 1;
        }
        .content-wrapper {
            display: flex;
            align-items: flex-start;
            height: 100%;
        }
        .masonry-column {
            display: flex;
            flex-direction: column;
            width: 160px;
            margin: 0 2px;
        }
        .grid-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        .grid-item.loaded img {
            opacity: 1;
        }
        .grid-item:hover {
            filter: grayscale(0%) brightness(100%);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.6);
            border-color: var(--accent-color);
        }
        @keyframes slideBackground {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        .notification-popup{background:var(--glass-bg);backdrop-filter:blur(var(--glass-blur));-webkit-backdrop-filter:blur(var(--glass-blur));padding:2.5rem 3.5rem;border-radius:20px;border:2px solid rgba(var(--border-color),.5);box-shadow:0 10px 30px rgba(0,0,0,.6);z-index:10;text-align:center;display:flex;flex-direction:column;align-items:center;gap:1.5rem;max-width:90%;transition:transform .4s ease-out,opacity .4s ease-out;opacity:0;transform:translateY(20px)}.notification-popup.show{opacity:1;transform:translateY(0)}.notification-popup:hover{transform:translateY(-5px);box-shadow:0 15px 40px rgba(0,0,0,.5)}.notification-popup .title{font-size:1.8rem;font-weight:700;color:var(--accent-color);text-shadow:0 2px 5px rgba(0,0,0,.5);margin:0}.notification-popup p{font-size:1.1rem;margin:0;color:var(--text-primary)}.notification-popup a{display:inline-block;background-color:var(--accent-color);color:var(--accent-text);padding:.75rem 2.5rem;border-radius:50px;text-decoration:none;font-weight:600;transition:all .2s ease;box-shadow:0 4px 10px rgba(0,0,0,.3)}.notification-popup a:hover{background-color:#f7e0a8;transform:scale(1.05);box-shadow:0 6px 15px rgba(0,0,0,.4)}
    </style>
</head>
<body>

    <div class="animated-background">
        <div class="image-flow-container" id="imageFlowContainer"></div>
    </div>

    <div class="mobile-view-container">
        <div class="notification-popup" id="notificationPopup">
            <h2 class="title">Notifikasi</h2>
            <p>Postingan ini telah di hapus ke<span class="highlight-text">halaman beranda</span> klik di bawah ini untuk menemukan novel lain untuk di baca</p>
            <a href="home.html" target="_blank">Beranda</a>
        </div>
    </div>

    <script src="js/config.js" defer></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const popup = document.getElementById('notificationPopup');
        if (popup) {
            setTimeout(() => popup.classList.add('show'), 500);
        }
        populateImageFlow(getFallbackImages(), false);
        fetchBlogImages();
    });

    async function fetchBlogImages() {
        const imageFlowContainer = document.getElementById('imageFlowContainer');
        if (!imageFlowContainer) return;

        if (typeof config === 'undefined' || config.blogId === 'GANTI_DENGAN_ID_BLOG_ANDA' || config.apiKey === 'GANTI_DENGAN_KUNCI_API_ANDA') {
            console.error("Konfigurasi Belum Diisi! Harap isi blogId dan apiKey di file app.js.");
            return;
        }

        try {
            const response = await fetch(`https://www.googleapis.com/blogger/v3/blogs/${config.blogId}/posts?key=${config.apiKey}&maxResults=150&fields=items(content)`);
            if (!response.ok) {
                const errorData = await response.json();
                console.error('Error dari Blogger API:', errorData.error.message);
                throw new Error(errorData.error.message);
            }
            const data = await response.json();
            let imageUrls = [];
            if (data && data.items) {
                data.items.forEach(post => {
                    if (!post.content) return;
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = post.content;
                    const imgTags = tempDiv.querySelectorAll('img');
                    imgTags.forEach(imgTag => {
                        if (imgTag && imgTag.src) {
                            imageUrls.push(imgTag.src);
                        }
                    });
                });
            }

            if (imageUrls.length > 0) {
                console.log(`Berhasil menemukan ${imageUrls.length} gambar dari blog.`);
                let finalImageSet = [...imageUrls];
                if (finalImageSet.length < 30) {
                    console.log("Jumlah gambar sedikit, menggandakan gambar untuk variasi animasi.");
                    while (finalImageSet.length < 80) {
                        finalImageSet.push(...imageUrls);
                    }
                }
                populateImageFlow(finalImageSet);
            } else {
                console.warn("Tidak ada gambar ditemukan di postingan blog, tetap menggunakan gambar fallback.");
            }
        } catch (error) {
            console.error('Gagal mengambil data dari Blogger API.', error);
            console.warn("Menggunakan gambar fallback.");
        }
    }

    function getFallbackImages() {
        const fallbackUrls = ['https://source.unsplash.com/random/400x600?game,art', 'https://source.unsplash.com/random/400x500?tech,abstract', 'https://source.unsplash.com/random/400x400?minimal,design', 'https://source.unsplash.com/random/400x700?cyber,puzzle', 'https://source.unsplash.com/random/400x300?creative,geometric', 'https://source.unsplash.com/random/400x550?space,stars', 'https://source.unsplash.com/random/400x650?city,lights', 'https://source.unsplash.com/random/400x450?nature,pattern'];
        let fullFallback = [];
        for (let i = 0; i < 20; i++) {
            fullFallback.push(...fallbackUrls);
        }
        return fullFallback;
    }

    function populateImageFlow(urls, isActualImages = true) {
        const imageFlowContainer = document.getElementById('imageFlowContainer');
        urls.sort(() => 0.5 - Math.random());
        const wrapper1 = createContentWrapper(urls, isActualImages);
        const wrapper2 = wrapper1.cloneNode(true);
        imageFlowContainer.innerHTML = '';
        imageFlowContainer.appendChild(wrapper1);
        imageFlowContainer.appendChild(wrapper2);
        setTimeout(() => {
            imageFlowContainer.classList.add('loaded');
        }, 20);
    }

    function createContentWrapper(urls, isActualImages) {
        const wrapper = document.createElement('div');
        wrapper.className = 'content-wrapper';
        const panelHeights = [100, 120, 140, 160, 180, 200, 220, 240, 260];
        const columnWidth = 160 + 4;
        const viewHeight = window.innerHeight;
        const numColumns = Math.ceil(window.innerWidth / columnWidth) + 2;
        const columns = [];
        const columnHeights = new Array(numColumns).fill(0);
        
        for (let i = 0; i < numColumns; i++) {
            const column = document.createElement('div');
            column.className = 'masonry-column';
            wrapper.appendChild(column);
            columns.push(column);
        }

        let imageIndex = 0;
        for (let i = 0; i < numColumns; i++) {
            while (columnHeights[i] < viewHeight) {
                if (urls.length === 0) break;
                const imageUrl = urls[imageIndex % urls.length];
                const randomHeight = panelHeights[Math.floor(Math.random() * panelHeights.length)];
                
                const item = document.createElement('div');
                item.className = 'grid-item';
                item.style.height = `${randomHeight}px`;

                // Jika isActualImages true, tambahkan tag <img> dengan URL asli
                if (isActualImages) {
                    const img = document.createElement('img');
                    img.src = imageUrl;
                    img.loading = 'lazy';
                    img.onload = () => {
                        item.classList.add('loaded');
                    };
                    img.onerror = () => {
                        item.classList.remove('loaded');
                    };
                    item.appendChild(img);
                } else {
                    item.classList.add('placeholder');
                }
                
                columns[i].appendChild(item);
                columnHeights[i] += randomHeight + 4;
                imageIndex++;
            }
        }
        return wrapper;
    }
    </script>
</body>
</html>